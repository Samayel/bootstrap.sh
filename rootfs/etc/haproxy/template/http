frontend ft_tcp80
    mode tcp
    option tcplog

    bind *:80
    bind :::80

    default_backend bk_tcp80_haproxy

backend bk_tcp80_haproxy
    mode tcp
    option tcplog

    server srv_http_haproxy unix@/http.sock send-proxy-v2

frontend ft_http
    mode http
    option httplog
    option forwardfor

    bind unix@/var/lib/haproxy/http.sock accept-proxy

    # Test URI to see if its a letsencrypt request
    acl acl_letsencrypt path_beg /.well-known/acme-challenge/

    redirect scheme https code 301 if !acl_letsencrypt
    use_backend bk_http_letsencrypt if acl_letsencrypt
